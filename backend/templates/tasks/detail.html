{% load static %}
{% load tracker_tags %}
{% load thumbnail %}

<head>
    <link rel="stylesheet" href="{% static 'css/default.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/tracker.css' %}">
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <script src="{% static 'js/highlight.min.js' %}"></script>
</head>

{% for TaskImage_object in images_in_task %}
    {% thumbnail TaskImage_object.image "160x110" crop="center" upscale=True as im %}
        <div id="overlay_{{ TaskImage_object.id }}" class="overlay" onclick="closeImageOverlay('{{ TaskImage_object.id }}')">
            <img src="{{ TaskImage_object.image.url }}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏">
        </div>
        <a href="javascript:void(0);" onclick="openImageOverlay('{{ TaskImage_object.id }}')">
            <img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏">
        </a>
    {% endthumbnail %}
{% endfor %}

{#{% autoescape on %}#}
    <div class="description">
        <p><b>–û–ø–∏—Å–∞–Ω–∏–µ:</b> {{ task.description|markdown }}</p>
    </div>
{#{% endautoescape %}#}

{% if task.tags %}
        {% for task_tag in task.tags.all %}
            <a href="{% url 'tags:by_tag' tag_name=task_tag.tag.name %}">
                <span type="button" class="badge bg-secondary" title="–¢–µ–≥–∏">
                    {{ task_tag.tag.name }}
                </span>
            </a>
        {% endfor %}
{% endif %}

{#{% if total_views %}#}
{#    <span class="badge rounded-pill bg-info text-dark" title="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ —Å—Ç—Ä–∞–Ω–∏—Ü—ã">#}
{#        üëÄ {{ total_views }}#}
{#    </span>#}
{#{% endif %}#}

{% if in_favorites %}
    <span class="badge rounded-pill bg-warning text-dark" title="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–µ–ª–æ–≤–µ–∫, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–±–∞–≤–∏–ª–∏ –∑–∞–¥–∞—á—É –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ">
        ‚òÖ {{ in_favorites }}
    </span>
{% endif %}

<hr>

<p>
    <a class="btn btn-outline-secondary" data-toggle="collapse" href="#collapseTaskDetails" role="button" aria-expanded="false" aria-controls="collapseTaskDetails">
        –î–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
    </a>
    <button class="btn btn-outline-success" data-toggle="collapse" href="#collapseTaskActions" role="button" aria-expanded="false" aria-controls="collapseTaskActions">
        –î–µ–π—Å—Ç–≤–∏—è —Å –∑–∞–¥–∞—á–µ–π
    </button>
</p>

<div class="collapse" id="collapseTaskDetails">
    <p><b>–ê–≤—Ç–æ—Ä:</b> {{ task.author }}</p>
    <p><b>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</b> {{ task.priority }}</p>
    <p><b>–°—Ç–∞—Ç—É—Å:</b> {{ task.status }}</p>
    <p><b>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:</b> {{ task.assigned_to }}</p>
    <p><b>–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è:</b> {{ task.created }}</p>
    <p><b>–î–µ–¥–ª–∞–π–Ω:</b> {{ task.deadline }}</p>
    {% if task.is_done %}
        <p><b>–ü–æ–º–µ—Ç–∏–ª(–∞) –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º:</b> {{ task.done_by }} ({{ task.done_by_time }})</p>
    {% endif %}
</div>

<script>
    function openImageOverlay(imageId) {
        document.getElementById('overlay_' + imageId).style.display = 'block';
    }

    function closeImageOverlay(imageId) {
        document.getElementById('overlay_' + imageId).style.display = 'none';
    }
</script>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    var imageTags = document.querySelectorAll('.description img');

    imageTags.forEach(function(imgTag) {
      var originalImageLink = document.createElement('a');
      originalImageLink.href = imgTag.src;
      originalImageLink.innerHTML = '–û—Ä–∏–≥–∏–Ω–∞–ª';
      originalImageLink.style.display = 'block';  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—É —Å—Ç–∏–ª—å block

      var paragraph = document.createElement('p');
      paragraph.style.textAlign = 'center';  // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç
      paragraph.appendChild(originalImageLink);

      imgTag.parentNode.insertBefore(paragraph, imgTag.nextSibling);
    });
  });
</script>

<script>
    hljs.highlightAll();
</script>