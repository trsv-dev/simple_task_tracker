{% extends 'base.html' %}

{% block title %}–î–µ—Ç–∞–ª–∏ –∑–∞–¥–∞—á–∏{% endblock %}

{% block content %}

{% if not task.is_draft or user == task.author %}
    <div class="container">

        {% include 'includes/pop_messages.html' %}

        <div class="card">

            {% include 'includes/task_title_colors.html' %}

        <div class="card-body">

          {% include 'tasks/detail.html' %}

            <div class="collapse" id="collapseTaskActions">
                  {% if user.is_authenticated and user != task.author %}
                      {% if not is_favorited %}
                        <a href="{% url 'favorites:add_to_favorites' pk=task.id %}" class="btn btn-outline-danger btn-sm"> ‚ù§Ô∏è –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
                      {% endif %}
                      {% if is_favorited %}
                        <a href="{% url 'favorites:delete_from_favorites' pk=task.id %}" class="btn btn-outline-danger btn-sm"> üíî –ò–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ</a>
                      {% endif %}
                  {% endif %}
                  {% if user.is_authenticated and task.is_done == False %}
                    {% if user.is_staff or user == task.author or user == task.assigned_to %}
                        {#    –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–ª–æ–∫ —á—Ç–æ–±—ã —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –º–µ—Ç–æ–¥ POST, –∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤ @require_POST #}
                        {% if user == task.author %}
                            <form method="post" action="{% url 'tracker:delete' pk=task.id %}" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-outline-danger btn-sm">–£–¥–∞–ª–∏—Ç—å</button>
                            </form>
                            <a href="{% url 'tracker:edit' pk=task.id %}" class="btn btn-outline-primary btn-sm">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                        {% endif %}
                        {% if not task.is_draft %}
                            {% if user == task.assigned_to %}
                                <a href="{% url 'tracker:mark_as_done' pk=task.id %}" class="btn btn-outline-success btn-sm">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</a>
                            {% endif %}
                            {% if user == task.assigned_to and task.status == '–û–∂–∏–¥–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è' %}
                                <a href="{% url 'tracker:change_task_status' pk=task.id %}" class="btn btn-outline-secondary btn-sm">–í–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É</a>
                            {% endif %}
                            {% if user == task.assigned_to and task.status != '–û–∂–∏–¥–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è' %}
                                <a href="{% url 'tracker:change_task_status' pk=task.id %}" class="btn btn-outline-secondary btn-sm">–í–µ—Ä–Ω—É—Ç—å –≤ –æ–∂–∏–¥–∞—é—â–∏–µ</a>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                  {% elif user == task.assigned_to %}
                      <form method="post" action="{% url 'tracker:mark_as_undone' pk=task.id %}" style="display:inline;">
                          {% csrf_token %}
                          <button type="submit" class="btn btn-outline-dark btn-sm" style="margin-left: auto;">–û—Ç–º–µ–Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</button>
                      </form>
                  {% endif %}
                {% if task.is_draft %}
                    <a href="{% url 'tracker:drafts' user=user %}" class="btn btn-outline-dark btn-sm">–ù–∞–∑–∞–¥</a>
                {% else %}
                    <a href="{% url 'tracker:index'%}" class="btn btn-outline-dark btn-sm">–ù–∞–∑–∞–¥</a>
                {% endif %}
            </div>
        </div>
      </div>
    </div>


    <div class="container">
        <div class="card-body">
             {% if comment_form.errors and request.method == 'POST' %}
                <div class="alert alert-danger">
                    {% for field, errors in comment_form.errors.items %}
                        {% for error in errors %}
                            {{ error }}
                        {% endfor %}
                        <br>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    </div>

    {% if not task.is_draft %}
        {% include 'comments/create_comment.html' %}
    {% endif %}

{% elif task.is_draft and user != task.author %}
    <div class="text-center">
        <p>üëÆ –≠—Ç–æ —á–µ—Ä–Ω–æ–≤–∏–∫ –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.</p>
        <p>–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ —á—É–∂–∏–º –∫ —á–µ—Ä–Ω–æ–≤–∏–∫–∞–º.</p>
    </div>
{% endif %}

{% endblock %}
